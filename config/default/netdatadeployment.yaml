---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: sa
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    configmap.reloader.stakater.com/reload: "config"
  name: netdata
spec:
  replicas: 1
  selector:
    matchLabels:
  template:
    metadata:
      labels:
    spec:
      volumes:
      - name: netdata-config
        configMap:
          name: config
      serviceAccountName: sa
      securityContext:
        {}
      hostNetwork: true
      hostName: mgmt1
      containers:
        - name: manager-nmap
          command:
          - /manager
          volumeMounts:
          - name: netdata-config
            mountPath: /etc/manager
          securityContext:
            capabilities:
              add:
              - NET_ADMIN
              - NET_RAW
              - NET_BIND_SERVICE
          image: "netdata-ipam:latest"
          imagePullPolicy: Always
          env:
          - name: NETSOURCE
            value: "nmap"
          - name: RECONCILETIMEOUT
            value: "600s"
          - name: ASSUME_NO_MOVING_GC_UNSAFE_RISK_IT_WITH
            value: go1.19
          resources:
            limits:
              cpu: 200m
              ephemeral-storage: 300Mi
              memory: 300Mi
            requests:
              cpu: 100m
              ephemeral-storage: 300Mi
              memory: 200Mi
        - name: manager-ndp
          command:
          - /manager
          volumeMounts:
          - name: netdata-config
            mountPath: /etc/manager
          securityContext:
            capabilities:
              add:
              - NET_ADMIN
              - NET_RAW
              - NET_BIND_SERVICE
          image: "netdata-ipam:latest"
          imagePullPolicy: Always
          env:
          - name: NETSOURCE
            value: "ndp"
          - name: RECONCILETIMEOUT
            value: "600s"
          - name: ASSUME_NO_MOVING_GC_UNSAFE_RISK_IT_WITH
            value: go1.19
          resources:
            limits:
              cpu: 200m
              ephemeral-storage: 300Mi
              memory: 300Mi
            requests:
              cpu: 100m
              ephemeral-storage: 300Mi
              memory: 200Mi
        - name: manager-kea
          command:
          - /manager
          volumeMounts:
          - name: netdata-config
            mountPath: /etc/manager
          securityContext:
            capabilities:
              add:
              - NET_ADMIN
              - NET_RAW
              - NET_BIND_SERVICE
          image: "netdata-ipam:latest"
          imagePullPolicy: Always
          env:
          - name: NETSOURCE
            value: "kea"
          - name: RECONCILETIMEOUT
            value: "600s"
          - name: ASSUME_NO_MOVING_GC_UNSAFE_RISK_IT_WITH
            value: go1.19
          resources:
            limits:
              cpu: 200m
              ephemeral-storage: 300Mi
              memory: 300Mi
            requests:
              cpu: 100m
              ephemeral-storage: 300Mi
              memory: 200Mi
